<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../../img/favicon.ico" />
    <title>How To Configure Device Control On Macos, Use Case 1. Deny Write Access To All Usb Storage Except For Specific Vendorid And Productid Combinations (Jamf) - The Escalation Protocol</title>
    <link rel="stylesheet" href="../../../../css/theme.css" />
    <link rel="stylesheet" href="../../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../../stylesheets/nav.css" rel="stylesheet" />
        <link href="../../../../stylesheets/layout.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "How To Configure Device Control On Macos, Use Case 1. Deny Write Access To All Usb Storage Except For Specific Vendorid And Productid Combinations (Jamf)";
        var mkdocs_page_input_path = "Defender for Endpoint/Endpoint Detection and Response/Device Control/How-to-Configure-Device-Control-on-macOS,-Use-case-1.-Deny-write-access-to-all-USB-storage-except-for-specific-VendorID-and-ProductID-combinations-(Jamf).md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../../.." class="icon icon-home"> The Escalation Protocol
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Defender for Endpoint</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" >Endpoint Detection and Response</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" >Alert Tunning</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../Alert%20Tunning/Alert-Tuning-Quick%E2%80%90Start-Guide-%28Beginner-Edition%29/">Alert Tuning Quick‚ÄêStart Guide (Beginner Edition)</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../Alert%20Tunning/Alert-Tuning-%E2%80%93-Comprehensive-Guide-%28Advanced-Edition%29/">Alert Tuning ‚Äì Comprehensive Guide (Advanced Edition)</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" >Device Control</a>
    <ul class="current">
                <li class="toctree-l3 current"><a class="reference internal current" href="#">How To Configure Device Control On Macos, Use Case 1. Deny Write Access To All Usb Storage Except For Specific Vendorid And Productid Combinations (Jamf)</a>
    <ul class="current">
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Using-the-device-control-policy-sample-builder/">Using The Device Control Policy Sample Builder</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >ECS</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../ECS/How%20to%20Manually%20Test%20MDE%E2%80%99s%20ECS%20Networking/">How To Manually Test Mde‚ÄôS Ecs Networking</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../mde_connectivity_channels/">Mde Connectivity Channels</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Microsoft Defender Core Service</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../Microsoft%20Defender%20Core%20Service/ecs_connectivity_diagnostic/">Ecs Connectivity Diagnostic</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Tags</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../Tags/Data-Driven%20Tags%20%E2%80%93%20Disabled%20and%20Isolated%20in%20Microsoft%20Defender%20for%20Endpoint/">Data Driven Tags ‚Äì Disabled And Isolated In Microsoft Defender For Endpoint</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Threat Vulnerability Management</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../Threat%20Vulnerability%20Management/Troubleshooting-Guide-%28TSG%29-CVE%E2%80%902023%E2%80%9049210-%E2%80%93-OpenSSL-Vulnerability-in-node%E2%80%90openssl-NPM-Package/">Troubleshooting Guide (Tsg) Cve‚Äê2023‚Äê49210 ‚Äì Openssl Vulnerability In Node‚ÄêOpenssl Npm Package</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Support Tips and Tools</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../Support%20Tips%20and%20Tools/Effective-Case-Notation-Good-practices-and-template/">Effective Case Notation Good Practices And Template</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../Support%20Tips%20and%20Tools/How-to-Craft-an-Effective-Root-Cause-Analysis-%28RCA%29/">How To Craft An Effective Root Cause Analysis (Rca)</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Derecho inform√°tico</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../Derecho%20inform%C3%A1tico/Delitos-Inform%C3%A1ticos-en-Costa-Rica-Mapeo-Jur%C3%ADdico%E2%80%90T%C3%A9cnico-y-Controles-ATT%26CK/">Delitos Inform√°ticos En Costa Rica Mapeo Jur√≠dico‚ÄêT√©cnico Y Controles Att&Ck</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../Derecho%20inform%C3%A1tico/Reflexi%C3%B3n%2C-Bienes-jur%C3%ADdicos-tutelados-en-una-eventual-legislaci%C3%B3n-de-IA-en-Costa-Rica/">Reflexi√≥n, Bienes Jur√≠dicos Tutelados En Una Eventual Legislaci√≥n De Ia En Costa Rica</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Day-to-Day Stuff</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../Day-to-Day%20Stuff/birthday-reminders/">Birthday Reminders</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../..">The Escalation Protocol</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Defender for Endpoint</li>
          <li class="breadcrumb-item">Endpoint Detection and Response</li>
          <li class="breadcrumb-item">Device Control</li>
      <li class="breadcrumb-item active">How To Configure Device Control On Macos, Use Case 1. Deny Write Access To All Usb Storage Except For Specific Vendorid And Productid Combinations (Jamf)</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="summary">Summary</h2>
<p>This article describes how to configure <strong>Microsoft Defender for Endpoint (MDE) Device Control</strong> on <strong>macOS</strong> to <strong>block write access to all removable media</strong>, while still allowing write access to a specific subset of <strong>Kingston USB drives</strong> based on their <strong>Vendor ID</strong> and <strong>Product ID</strong>. The policy is deployed using <strong>Jamf Pro</strong>.</p>
<p>The guidance includes:</p>
<ul>
<li>An overview of how device control works in MDE on macOS  </li>
<li>Step-by-step instructions for building the custom policy  </li>
<li>Validation tips before deployment  </li>
<li>References to official Microsoft documentation  </li>
</ul>
<blockquote>
<p>‚úÖ <strong>Use case:</strong> You want to ensure only company-approved USB drives can be written to on managed macOS devices, as part of your data loss prevention (DLP) or endpoint hardening strategy.</p>
</blockquote>
<hr />
<h2 id="environment">Environment</h2>
<ul>
<li><strong>Product:</strong> Microsoft Defender for Endpoint (macOS)  </li>
<li><strong>OS:</strong> macOS 11+ (Big Sur or later)  </li>
<li><strong>MDM:</strong> Jamf Pro  </li>
<li><strong>Requirement:</strong> Defender for Endpoint CLI installed  </li>
</ul>
<hr />
<h2 id="background">Background</h2>
<p>Microsoft Defender for Endpoint supports <strong>device control</strong> on macOS, allowing administrators to:</p>
<ul>
<li><strong>Block or allow</strong> read/write access to specific types of hardware  </li>
<li><strong>Target devices</strong> by attributes such as <code>vendorId</code>, <code>productId</code>, and device class  </li>
<li>Use <strong>JSON-based policy</strong> delivered via <strong>MDM configuration profiles</strong>  </li>
</ul>
<p>On macOS, device control policies must be authored manually in JSON and validated locally using the Defender CLI before deployment through Jamf.</p>
<hr />
<h2 id="problem">Problem</h2>
<p>You need to:</p>
<ol>
<li><strong>Block write access</strong> to all removable media (e.g., USB flash drives)  </li>
<li><strong>Allow write access</strong> to a select group of <strong>Kingston USB drives</strong>, identified by a <strong>Vendor ID</strong> (<code>0951</code>) and multiple <strong>Product IDs</strong>  </li>
</ol>
<p>This ensures users can only write to <strong>pre-approved USB drives</strong>, reducing data exfiltration risk.</p>
<hr />
<h2 id="solution">Solution</h2>
<h3 id="step-1-define-device-groups">üîπ Step 1: Define Device Groups</h3>
<p>We will define:</p>
<ul>
<li>A group that matches <strong>all removable media devices</strong>  </li>
<li>A second group that includes only the <strong>approved Kingston USB drives</strong></li>
</ul>
<pre><code class="language-json">&quot;groups&quot;: [
  {
    &quot;id&quot;: &quot;group1&quot;,
    &quot;name&quot;: &quot;All Removable Media Devices&quot;,
    &quot;query&quot;: {
      &quot;$type&quot;: &quot;primaryId&quot;,
      &quot;value&quot;: &quot;removable_media_devices&quot;
    }
  },
  {
    &quot;id&quot;: &quot;group2&quot;,
    &quot;name&quot;: &quot;Allowed Kingston USBs&quot;,
    &quot;query&quot;: {
      &quot;$type&quot;: &quot;all&quot;,
      &quot;clauses&quot;: [
        { &quot;$type&quot;: &quot;vendorId&quot;, &quot;value&quot;: &quot;0951&quot; },
        {
          &quot;$type&quot;: &quot;any&quot;,
          &quot;clauses&quot;: [
            { &quot;$type&quot;: &quot;productId&quot;, &quot;value&quot;: &quot;1234&quot; },
            { &quot;$type&quot;: &quot;productId&quot;, &quot;value&quot;: &quot;5678&quot; },
            { &quot;$type&quot;: &quot;productId&quot;, &quot;value&quot;: &quot;9012&quot; }
          ]
        }
      ]
    }
  }
]
</code></pre>
<h4 id="explanation">üìò Explanation</h4>
<ul>
<li><code>0951</code> is the <strong>Vendor ID for Kingston</strong>  </li>
<li>The <code>any</code> clause matches <strong>any of the listed Product IDs</strong>, allowing flexibility if multiple Kingston USB models are in use  </li>
<li>These device groups act as the <strong>foundation</strong> for rules later in the policy</li>
</ul>
<hr />
<h3 id="step-2-define-write-access-rule">üîπ Step 2: Define Write Access Rule</h3>
<p>Create a rule that:</p>
<ul>
<li><strong>Includes all removable media</strong>  </li>
<li><strong>Excludes the allowed Kingston USB group</strong>  </li>
<li><strong>Denies write access</strong>  </li>
<li>Optionally <strong>audits and notifies</strong> on denied attempts</li>
</ul>
<pre><code class="language-json">&quot;rules&quot;: [
  {
    &quot;id&quot;: &quot;rule1&quot;,
    &quot;name&quot;: &quot;Block Write Access Except for Allowed Kingston Devices&quot;,
    &quot;includeGroups&quot;: [ &quot;group1&quot; ],
    &quot;excludeGroups&quot;: [ &quot;group2&quot; ],
    &quot;entries&quot;: [
      {
        &quot;$type&quot;: &quot;removableMedia&quot;,
        &quot;id&quot;: &quot;entry1&quot;,
        &quot;enforcement&quot;: { &quot;$type&quot;: &quot;deny&quot; },
        &quot;access&quot;: [ &quot;write&quot; ]
      },
      {
        &quot;$type&quot;: &quot;removableMedia&quot;,
        &quot;id&quot;: &quot;entry2&quot;,
        &quot;enforcement&quot;: {
          &quot;$type&quot;: &quot;auditDeny&quot;,
          &quot;options&quot;: [ &quot;send_event&quot;, &quot;show_notification&quot; ]
        },
        &quot;access&quot;: [ &quot;write&quot; ]
      }
    ]
  }
]
</code></pre>
<h4 id="explanation_1">üìò Explanation</h4>
<ul>
<li><code>includeGroups</code> targets <strong>all USB drives</strong>  </li>
<li><code>excludeGroups</code> removes <strong>only the approved Kingston USBs</strong>  </li>
<li><code>deny</code> blocks write access for non-approved drives  </li>
<li><code>auditDeny</code> triggers event logging and user notifications  </li>
</ul>
<hr />
<h3 id="step-3-validate-the-policy-locally">üîπ Step 3: Validate the Policy Locally</h3>
<p>Use the Defender CLI to validate your JSON before deployment:</p>
<pre><code class="language-bash">mdatp device-control policy validate --path /path/to/your-policy.json
</code></pre>
<h4 id="explanation_2">üìò Explanation</h4>
<ul>
<li>Ensures the JSON is syntactically correct and matches Defender‚Äôs schema  </li>
<li>Prevents deployment failures due to malformed profiles</li>
</ul>
<hr />
<h3 id="step-4-deploy-via-jamf-pro">üîπ Step 4: Deploy via Jamf Pro</h3>
<p>Once validated:</p>
<ol>
<li>Wrap the JSON in a <strong>Jamf custom configuration profile</strong>  </li>
<li>Use the <strong>preference domain</strong>: <code>com.microsoft.wdav</code>  </li>
<li>Deploy the profile to scoped macOS devices  </li>
</ol>
<blockquote>
<p>üí° For help creating configuration profiles in Jamf, refer to the <a href="https://docs.jamf.com/">Jamf Custom Profiles Guide</a>.</p>
</blockquote>
<hr />
<h2 id="best-practices">‚úÖ Best Practices</h2>
<ul>
<li>Always <strong>test on a non-production device</strong>  </li>
<li><strong>Keep your JSON policy files in version control</strong>  </li>
<li>Maintain an <strong>inventory of approved Vendor/Product IDs</strong>  </li>
<li><strong>Educate users</strong> on new restrictions to avoid support tickets  </li>
</ul>
<hr />
<h2 id="references">üìö References</h2>
<ul>
<li><a href="https://learn.microsoft.com/en-us/defender-endpoint/mac-device-control-jamf">üìò Device Control on macOS ‚Äì Microsoft Docs</a>  </li>
<li><a href="https://github.com/MicrosoftDocs/microsoft-365-docs">üíæ Microsoft Defender GitHub ‚Äì Sample JSON Files</a>  </li>
<li><a href="https://docs.jamf.com/">üõ†Ô∏è Jamf Pro: Custom Configuration Profiles</a>  </li>
</ul>
<h2 id="additional-tips">Additional tips:</h2>
<p>You can build simple policies based on your use case using the <a href="https://github.com/Arkthos/The-Escalation-Protocol/wiki/Using-the-device-control-policy-sample-builder">Policy Builder</a></p>
<hr />
<p><strong>Author:</strong> Arkthos</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../Alert%20Tunning/Alert-Tuning-%E2%80%93-Comprehensive-Guide-%28Advanced-Edition%29/" class="btn btn-neutral float-left" title="Alert Tuning ‚Äì Comprehensive Guide (Advanced Edition)"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../Using-the-device-control-policy-sample-builder/" class="btn btn-neutral float-right" title="Using The Device Control Policy Sample Builder">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../../Alert%20Tunning/Alert-Tuning-%E2%80%93-Comprehensive-Guide-%28Advanced-Edition%29/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../Using-the-device-control-policy-sample-builder/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../../..";</script>
    <script src="../../../../js/theme_extra.js"></script>
    <script src="../../../../js/theme.js"></script>
      <script src="../../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
